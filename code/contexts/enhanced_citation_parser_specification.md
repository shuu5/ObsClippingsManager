# AIç†è§£æ”¯æ´å¼•ç”¨æ–‡çŒ®ãƒ‘ãƒ¼ã‚µãƒ¼æ©Ÿèƒ½ä»•æ§˜æ›¸ v4.0

## æ¦‚è¦
ObsClippingsManager v4.0ã«ãŠã‘ã‚‹å¼•ç”¨æ–‡çŒ®ãƒ‘ãƒ¼ã‚¹æ©Ÿèƒ½ã®é©æ–°çš„å¼·åŒ–ç‰ˆã§ã™ã€‚**AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆï¼ˆChatGPTã€Claudeç­‰ï¼‰ãŒå¼•ç”¨æ–‡çŒ®ã‚’å®Œå…¨ã«ç†è§£ã—ã€é©åˆ‡ãªå¼•ç”¨ä»˜ãè«–æ–‡ã‚’åŸ·ç­†ã§ãã‚‹ã‚ˆã†æ”¯æ´ã™ã‚‹**ã“ã¨ã‚’ä¸»ç›®çš„ã¨ã—ã¾ã™ã€‚

**YAMLãƒ˜ãƒƒãƒ€ãƒ¼å®Œå…¨çµ±åˆæ–¹å¼**ã«ã‚ˆã‚Šã€ãƒ•ã‚¡ã‚¤ãƒ«å˜ä½“ã§å…¨ã¦ã®å¼•ç”¨æƒ…å ±ã‚’ç®¡ç†ã—ã€å¤–éƒ¨ä¾å­˜ã‚’æ’é™¤ã—ãŸè‡ªå·±å®Œçµå‹ã®ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

## èƒŒæ™¯ã¨è§£æ±ºã™ã¹ãèª²é¡Œ

### ç¾åœ¨ã®å•é¡Œ
```
ãƒ¦ãƒ¼ã‚¶ãƒ¼ â†’ AIï¼šã€Œã“ã®è«–æ–‡ã®Introductionã‚’ã¾ã¨ã‚ã¦ã€

AIï¼šã€Œ[1],[2],[3]ã¨ã„ã†å¼•ç”¨ãŒã‚ã‚Šã¾ã™ãŒã€ã“ã‚ŒãŒä½•ã®æ–‡çŒ®ãªã®ã‹åˆ†ã‹ã‚‰ãªã„ãŸã‚ã€
     é©åˆ‡ãªå¼•ç”¨ä»˜ãã®æ–‡ç« ã‚’ä½œæˆã§ãã¾ã›ã‚“ã€
```

### ç›®æ¨™ï¼šAIãŒå®Œå…¨ç†è§£ã§ãã‚‹çµ±åˆãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
```
ObsClippingsManagerå‡¦ç†å¾Œ:

## ğŸ“š Citation Reference Table
[1] â†’ Smith, J. et al. (2023). "Novel Method for Cancer Analysis". Cancer Research, 83(12), 1234-1245.
[2] â†’ Jones, M. & Wilson, K. (2022). "Advanced Biomarker Techniques". Nature Medicine, 28, 567-578.
[3] â†’ Brown, A. (2021). "Differential Diagnosis in Oncology". Cell, 185, 890-905.

## ğŸ“„ Paper Content
Aberrant expression in various cancers makes KRTs useful as biomarkers [1],[2],[3].

AIï¼šã€Œ[1]ã¯Smith et al.ã®ãŒã‚“è§£ææ‰‹æ³•ã®è«–æ–‡ã€[2]ã¯Jonesã®ãƒã‚¤ã‚ªãƒãƒ¼ã‚«ãƒ¼æŠ€è¡“è«–æ–‡ã€
     [3]ã¯Brownã®è¨ºæ–­å­¦è«–æ–‡ã§ã™ã­ã€‚ã“ã‚Œã‚‰ã‚’è¸ã¾ãˆã¦é©åˆ‡ãªè«–æ–‡ã‚’åŸ·ç­†ã—ã¾ã™ã€
```

## ä¸»è¦æ©Ÿèƒ½

### 1. å®Œå…¨çµ±åˆå¼•ç”¨ãƒãƒƒãƒ”ãƒ³ã‚°æ©Ÿèƒ½
- YAMLãƒ˜ãƒƒãƒ€ãƒ¼ã«å…¨ã¦ã®å¼•ç”¨æ–‡çŒ®æƒ…å ±ã‚’å®Œå…¨çµ±åˆ
- references.bibã‹ã‚‰ä¸€åº¦èª­ã¿è¾¼ã¿ã€Markdownãƒ•ã‚¡ã‚¤ãƒ«ã«æ°¸ç¶šåŒ–
- å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ä¾å­˜ã‚’æ’é™¤ã—ãŸè‡ªå·±å®Œçµå‹è¨­è¨ˆ

### 2. AIç”¨çµ±åˆãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆæ©Ÿèƒ½ï¼ˆæ ¸å¿ƒæ©Ÿèƒ½ï¼‰
- YAMLãƒ˜ãƒƒãƒ€ãƒ¼ã®æƒ…å ±ã®ã¿ã‚’ä½¿ç”¨ã—ã¦AIç†è§£ç”¨ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
- Citation Reference Table + Paper Contentå½¢å¼
- é«˜é€Ÿã§ä¿¡é ¼æ€§ã®é«˜ã„å‡¦ç†

## æ©Ÿèƒ½è©³ç´°ä»•æ§˜

### 1. å®Œå…¨çµ±åˆå¼•ç”¨ãƒãƒƒãƒ”ãƒ³ã‚°æ©Ÿèƒ½

#### YAMLãƒ˜ãƒƒãƒ€ãƒ¼å®Œå…¨çµ±åˆå½¢å¼
```yaml
---
title: "è«–æ–‡ã‚¿ã‚¤ãƒˆãƒ«"
doi: "10.1093/jrr/rrac091"
# å®Œå…¨çµ±åˆå¼•ç”¨ãƒãƒƒãƒ”ãƒ³ã‚°
citations:
  1:
    citation_key: "smith2023test"
    title: "Novel Method for Cancer Cell Analysis"
    authors: "Smith, J., Wilson, K., & Davis, M."
    year: 2023
    journal: "Cancer Research"
    volume: "83"
    number: "12"
    pages: "1234-1245"
    doi: "10.1158/0008-5472.CAN-23-0123"
    abstract: "This paper introduces innovative methodologies for analyzing cancer cell behavior using advanced computational techniques."
    
  2:
    citation_key: "jones2022biomarkers"
    title: "Advanced Biomarker Techniques in Oncology"
    authors: "Jones, M. & Brown, A."
    year: 2022
    journal: "Nature Medicine"
    volume: "28"
    pages: "567-578"
    doi: "10.1038/s41591-022-0456-7"
    abstract: "Comprehensive review of current biomarker applications in cancer diagnosis and treatment monitoring."
    
  3:
    citation_key: "brown2021diagnosis"
    title: "Differential Diagnosis Methods in Modern Oncology"
    authors: "Brown, A., Lee, S., & Kumar, R."
    year: 2021
    journal: "Cell"
    volume: "185"
    pages: "890-905"
    doi: "10.1016/j.cell.2021.03.012"
    abstract: "Systematic approach to differential diagnosis using molecular markers and advanced imaging techniques."

# ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
citation_metadata:
  total_citations: 3
  last_updated: "2024-01-15T10:30:00"
  source_bibtex: "references.bib"
  mapping_version: "2.0"
---
```

#### å®Ÿè£…ã‚¯ãƒ©ã‚¹
```python
class CompleteCitationManager:
    """å®Œå…¨çµ±åˆå¼•ç”¨ç®¡ç†ã‚¨ãƒ³ã‚¸ãƒ³"""
    
    def create_complete_mapping(self, markdown_file: str, references_bib: str) -> CompleteCitationMapping:
        """
        references.bibã‹ã‚‰å®Œå…¨ãªå¼•ç”¨æƒ…å ±ã‚’èª­ã¿è¾¼ã¿YAMLãƒ˜ãƒƒãƒ€ãƒ¼ã«çµ±åˆ
        
        Process:
        1. Markdownãƒ•ã‚¡ã‚¤ãƒ«å†…ã®å¼•ç”¨ç•ªå·ã‚’æ¤œå‡º
        2. references.bibã‹ã‚‰å…¨ã¦ã®æ–‡çŒ®æƒ…å ±ã‚’å–å¾—
        3. å¼•ç”¨ç•ªå·é †ã«å®Œå…¨ãªæ–‡çŒ®æƒ…å ±ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°
        4. YAMLãƒ˜ãƒƒãƒ€ãƒ¼ã«å®Œå…¨ãªæƒ…å ±ã‚’åŸ‹ã‚è¾¼ã¿
        
        Returns:
            CompleteCitationMapping: å®Œå…¨ãªå¼•ç”¨ãƒãƒƒãƒ”ãƒ³ã‚°æƒ…å ±
        """
        
    def update_yaml_header_complete(self, markdown_file: str, mapping: CompleteCitationMapping) -> bool:
        """
        YAMLãƒ˜ãƒƒãƒ€ãƒ¼ã«å®Œå…¨ãªå¼•ç”¨æƒ…å ±ã‚’è¿½åŠ ãƒ»æ›´æ–°
        
        Args:
            markdown_file: å¯¾è±¡Markdownãƒ•ã‚¡ã‚¤ãƒ«
            mapping: å®Œå…¨ãªå¼•ç”¨ãƒãƒƒãƒ”ãƒ³ã‚°æƒ…å ±
            
        Returns:
            æˆåŠŸãƒ•ãƒ©ã‚°
        """
        
    def extract_citation_from_yaml(self, markdown_file: str, citation_number: int) -> CitationInfo:
        """
        YAMLãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰ç‰¹å®šã®å¼•ç”¨æƒ…å ±ã‚’å–å¾—
        
        Args:
            markdown_file: å¯¾è±¡Markdownãƒ•ã‚¡ã‚¤ãƒ«
            citation_number: å¼•ç”¨ç•ªå·
            
        Returns:
            CitationInfo: å®Œå…¨ãªå¼•ç”¨æ–‡çŒ®æƒ…å ±
        """
```

### 2. AIç”¨çµ±åˆãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆæ©Ÿèƒ½ï¼ˆæ ¸å¿ƒæ©Ÿèƒ½ï¼‰

#### ç”Ÿæˆã•ã‚Œã‚‹çµ±åˆãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼
```markdown
# è«–æ–‡ã‚¿ã‚¤ãƒˆãƒ«
*Generated by ObsClippingsManager v4.0 for AI Assistant*
*Self-contained document with embedded citation information*

## ğŸ“š Citation Reference Table
**AI Assistant Reference Guide: This table provides complete citation information for all numbered references in the paper.**

[1] â†’ **Smith, J., Wilson, K., & Davis, M.** (2023). *Novel Method for Cancer Cell Analysis*. **Cancer Research**, 83(12), 1234-1245. DOI: 10.1158/0008-5472.CAN-23-0123
    â””â”€ **Abstract**: This paper introduces innovative methodologies for analyzing cancer cell behavior using advanced computational techniques.

[2] â†’ **Jones, M. & Brown, A.** (2022). *Advanced Biomarker Techniques in Oncology*. **Nature Medicine**, 28, 567-578. DOI: 10.1038/s41591-022-0456-7
    â””â”€ **Abstract**: Comprehensive review of current biomarker applications in cancer diagnosis and treatment monitoring.

[3] â†’ **Brown, A., Lee, S., & Kumar, R.** (2021). *Differential Diagnosis Methods in Modern Oncology*. **Cell**, 185, 890-905. DOI: 10.1016/j.cell.2021.03.012
    â””â”€ **Abstract**: Systematic approach to differential diagnosis using molecular markers and advanced imaging techniques.

---

## ğŸ“„ Paper Content

### Introduction
Aberrant expression in various cancers makes KRTs useful as biomarkers for differential diagnoses and metastatic status. Recent studies suggest that KRTs in cancer cells are not only epithelial marker proteins but are also mediators capable of interacting with a range of proteins to regulate signaling networks associated with cell death, survival, proliferation, migration, invasion and metastasis [1],[2],[3].

The established framework [2] provides a foundation for understanding biomarker applications, while novel analytical methods [1] offer new insights into cancer cell behavior. Previous comprehensive studies [3] have demonstrated the importance of systematic diagnostic approaches.

---
*End of AI Assistant Document*
*Original file: paper.md | Generated: 2024-01-15 10:30:00*
*Citation source: Self-contained YAML header*
```

#### å®Ÿè£…ã‚¯ãƒ©ã‚¹
```python
class SelfContainedAIGenerator:
    """è‡ªå·±å®Œçµå‹AIçµ±åˆãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆå™¨"""
    
    def generate_ai_readable_file(self, markdown_file: str, output_file: str = None) -> str:
        """
        YAMLãƒ˜ãƒƒãƒ€ãƒ¼ã®æƒ…å ±ã®ã¿ã‚’ä½¿ç”¨ã—ã¦AIç†è§£ç”¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
        
        Args:
            markdown_file: å…ƒã®Markdownãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆYAMLãƒ˜ãƒƒãƒ€ãƒ¼ã«å®Œå…¨ãªå¼•ç”¨æƒ…å ±ã‚’å«ã‚€ï¼‰
            output_file: å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆæœªæŒ‡å®šæ™‚ã¯è‡ªå‹•ç”Ÿæˆï¼‰
            
        Returns:
            ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
            
        Process:
        1. YAMLãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰å®Œå…¨ãªå¼•ç”¨æƒ…å ±ã‚’èª­ã¿è¾¼ã¿
        2. Citation Reference Tableã‚’ç”Ÿæˆ
        3. å…ƒã®Paper Contentã¨çµ±åˆ
        4. AIç†è§£æœ€é©åŒ–ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§å‡ºåŠ›
        
        Note: å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ä¾å­˜ãªã—ã€é«˜é€Ÿå‡¦ç†
        """
        
    def create_citation_reference_table(self, citations: Dict[int, CitationInfo]) -> str:
        """
        YAMLãƒ˜ãƒƒãƒ€ãƒ¼ã®æƒ…å ±ã‹ã‚‰AIç†è§£ç”¨Citation Reference Tableã‚’ç”Ÿæˆ
        
        Format:
        [ç•ªå·] â†’ **è‘—è€…** (å¹´). *ã‚¿ã‚¤ãƒˆãƒ«*. **ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«**, å·»(å·), ãƒšãƒ¼ã‚¸. DOI: xxx
            â””â”€ **Abstract**: è«–æ–‡ã®è¦ç´„
        """
        
    def validate_self_contained_file(self, markdown_file: str) -> bool:
        """
        ãƒ•ã‚¡ã‚¤ãƒ«ãŒè‡ªå·±å®Œçµå‹ã‹ã©ã†ã‹ã‚’æ¤œè¨¼
        
        Returns:
            True: å…¨ã¦ã®å¼•ç”¨æƒ…å ±ãŒYAMLãƒ˜ãƒƒãƒ€ãƒ¼ã«å«ã¾ã‚Œã¦ã„ã‚‹
            False: å¤–éƒ¨ä¾å­˜ã¾ãŸã¯æƒ…å ±ä¸è¶³
        """
```

## ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ä»•æ§˜

### åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰

#### 1. å®Œå…¨çµ±åˆãƒãƒƒãƒ”ãƒ³ã‚°ä½œæˆ
```bash
# references.bibã‹ã‚‰å®Œå…¨ãªå¼•ç”¨æƒ…å ±ã‚’YAMLãƒ˜ãƒƒãƒ€ãƒ¼ã«çµ±åˆ
PYTHONPATH=code/py uv run python code/py/main.py create-complete-mapping \
    --input paper.md \
    --references references.bib
```

#### 2. AIç”¨çµ±åˆãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆï¼ˆæ ¸å¿ƒæ©Ÿèƒ½ï¼‰
```bash
# YAMLãƒ˜ãƒƒãƒ€ãƒ¼ã®æƒ…å ±ã®ã¿ã‚’ä½¿ç”¨ã—ã¦AIç†è§£ç”¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
PYTHONPATH=code/py uv run python code/py/main.py generate-ai-format \
    --input paper.md \
    --output paper_for_ai.md
```

#### 3. è‡ªå·±å®Œçµæ€§æ¤œè¨¼
```bash
# ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤–éƒ¨ä¾å­˜ãªã—ã§å®Œå…¨ã‹ã©ã†ã‹ã‚’æ¤œè¨¼
PYTHONPATH=code/py uv run python code/py/main.py validate-self-contained \
    --input paper.md
```

#### 4. çµ±åˆå‡¦ç†
```bash
# å®Œå…¨ãƒãƒƒãƒ”ãƒ³ã‚°ä½œæˆ + AIå½¢å¼ç”Ÿæˆã‚’ä¸€æ‹¬å®Ÿè¡Œ
PYTHONPATH=code/py uv run python code/py/main.py parse-citations \
    --input paper.md \
    --references references.bib \
    --generate-ai-format \
    --output-dir ./ai_ready/
```

### çµ±åˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¸ã®çµ„ã¿è¾¼ã¿
```bash
# run-integratedã«è‡ªå‹•çµ„ã¿è¾¼ã¿
PYTHONPATH=code/py uv run python code/py/main.py run-integrated \
    --enable-self-contained-citations
```

## è¨­å®šä»•æ§˜

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
```yaml
# config/self_contained_citation_parser.yaml
self_contained_citation_parser:
  # å®Œå…¨çµ±åˆè¨­å®š
  complete_mapping:
    auto_create: true                    # è‡ªå‹•å®Œå…¨ãƒãƒƒãƒ”ãƒ³ã‚°ä½œæˆ
    update_yaml_header: true             # YAMLãƒ˜ãƒƒãƒ€ãƒ¼è‡ªå‹•æ›´æ–°
    backup_original: true                # å…ƒãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
    include_abstracts: true              # è¦ç´„æƒ…å ±ã‚’å«ã‚ã‚‹
    
  # AIçµ±åˆãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆè¨­å®š
  ai_format:
    enable_generation: true              # AIå½¢å¼ç”Ÿæˆæœ‰åŠ¹åŒ–
    include_abstracts: true              # è¦ç´„æƒ…å ±å«ã‚ã‚‹
    reference_table_style: "enhanced"    # enhanced | simple
    output_suffix: "_for_ai"             # å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«æ¥å°¾è¾
    
  # è‡ªå·±å®Œçµæ€§è¨­å®š
  self_contained:
    strict_validation: true              # å³å¯†ãªè‡ªå·±å®Œçµæ€§æ¤œè¨¼
    allow_partial_info: false            # éƒ¨åˆ†çš„ãªæƒ…å ±ã‚’è¨±å¯ã—ãªã„
    require_abstracts: true              # è¦ç´„æƒ…å ±ã‚’å¿…é ˆã¨ã™ã‚‹
```

## ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### CompleteCitationMapping
```python
@dataclass
class CompleteCitationMapping:
    """å®Œå…¨çµ±åˆå¼•ç”¨ãƒãƒƒãƒ”ãƒ³ã‚°æƒ…å ±"""
    citations: Dict[int, CitationInfo]   # å¼•ç”¨ç•ªå· â†’ å®Œå…¨ãªæ–‡çŒ®æƒ…å ±
    total_citations: int                 # ç·å¼•ç”¨æ•°
    last_updated: datetime               # æœ€çµ‚æ›´æ–°æ™‚åˆ»
    source_bibtex: str                   # å…ƒã®BibTeXãƒ•ã‚¡ã‚¤ãƒ«
    mapping_version: str                 # ãƒãƒƒãƒ”ãƒ³ã‚°ãƒãƒ¼ã‚¸ãƒ§ãƒ³
    is_self_contained: bool              # è‡ªå·±å®Œçµãƒ•ãƒ©ã‚°
```

### CitationInfo
```python
@dataclass  
class CitationInfo:
    """å®Œå…¨ãªå¼•ç”¨æ–‡çŒ®æƒ…å ±"""
    citation_key: str                    # BibTeX citation_key
    title: str                           # è«–æ–‡ã‚¿ã‚¤ãƒˆãƒ«
    authors: str                         # è‘—è€…æƒ…å ±
    year: int                            # ç™ºè¡Œå¹´
    journal: str                         # ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«å
    volume: str                          # å·»å·æƒ…å ±
    number: str                          # å·æ•°æƒ…å ±
    pages: str                           # ãƒšãƒ¼ã‚¸æƒ…å ±
    doi: str                             # DOI
    abstract: str                        # è«–æ–‡è¦ç´„
    url: str                             # URLï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    keywords: List[str]                  # ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
```

### SelfContainedDocument
```python
@dataclass
class SelfContainedDocument:
    """è‡ªå·±å®Œçµå‹çµ±åˆæ–‡æ›¸"""
    original_file: str                   # å…ƒãƒ•ã‚¡ã‚¤ãƒ«
    citations: Dict[int, CitationInfo]   # å®Œå…¨ãªå¼•ç”¨æƒ…å ±
    citation_table: str                  # Citation Reference Table
    paper_content: str                   # è«–æ–‡å†…å®¹
    generation_timestamp: datetime      # ç”Ÿæˆæ™‚åˆ»
    total_citations: int                 # ç·å¼•ç”¨æ•°
    is_self_contained: bool              # è‡ªå·±å®Œçµãƒ•ãƒ©ã‚°
```

## ãƒ†ã‚¹ãƒˆä»•æ§˜

### æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ

#### 1. å®Œå…¨ãƒãƒƒãƒ”ãƒ³ã‚°ä½œæˆãƒ†ã‚¹ãƒˆ
```python
def test_complete_mapping_creation():
    """å®Œå…¨çµ±åˆãƒãƒƒãƒ”ãƒ³ã‚°ä½œæˆã®ãƒ†ã‚¹ãƒˆ"""
    markdown_file = "test_paper.md"
    references_bib = "test_references.bib"
    
    mapping = manager.create_complete_mapping(markdown_file, references_bib)
    
    assert mapping.total_citations == 3
    assert mapping.is_self_contained == True
    assert 1 in mapping.citations
    assert mapping.citations[1].title == "Novel Method for Cancer Analysis"
    assert mapping.citations[1].authors == "Smith, J., Wilson, K., & Davis, M."
    assert mapping.citations[1].abstract != ""
```

#### 2. è‡ªå·±å®Œçµå‹AIçµ±åˆãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆãƒ†ã‚¹ãƒˆ
```python
def test_self_contained_ai_file_generation():
    """è‡ªå·±å®Œçµå‹AIç†è§£ç”¨ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆã®ãƒ†ã‚¹ãƒˆ"""
    input_file = "test_paper_with_complete_yaml.md"
    output_file = generator.generate_ai_readable_file(input_file)
    
    with open(output_file, 'r') as f:
        content = f.read()
    
    # Citation Reference Tableå­˜åœ¨ç¢ºèª
    assert "ğŸ“š Citation Reference Table" in content
    assert "[1] â†’ **Smith, J." in content
    assert "**Abstract**:" in content
    
    # Paper Contentå­˜åœ¨ç¢ºèª  
    assert "ğŸ“„ Paper Content" in content
    assert "Self-contained document" in content
```

#### 3. è‡ªå·±å®Œçµæ€§æ¤œè¨¼ãƒ†ã‚¹ãƒˆ
```python
def test_self_contained_validation():
    """è‡ªå·±å®Œçµæ€§æ¤œè¨¼ã®ãƒ†ã‚¹ãƒˆ"""
    complete_file = "test_complete.md"
    incomplete_file = "test_incomplete.md"
    
    assert generator.validate_self_contained_file(complete_file) == True
    assert generator.validate_self_contained_file(incomplete_file) == False
```

### çµ±åˆãƒ†ã‚¹ãƒˆ

#### å¤–éƒ¨ä¾å­˜ãªã—é«˜é€Ÿå‡¦ç†ãƒ†ã‚¹ãƒˆ
```python
def test_no_external_dependency():
    """å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ä¾å­˜ãªã—ã§å‡¦ç†ã§ãã‚‹ã“ã¨ã®ãƒ†ã‚¹ãƒˆ"""
    
    # references.bibã‚’å‰Šé™¤
    os.remove("references.bib")
    
    # YAMLãƒ˜ãƒƒãƒ€ãƒ¼ã®ã¿ã§AIç”¨ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
    ai_file = generator.generate_ai_readable_file("complete_paper.md")
    
    # æˆåŠŸã™ã‚‹ã“ã¨ã‚’ç¢ºèª
    assert os.path.exists(ai_file)
    
    # å‡¦ç†æ™‚é–“ãŒé«˜é€Ÿã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
    start_time = time.time()
    generator.generate_ai_readable_file("complete_paper.md")
    processing_time = time.time() - start_time
    
    assert processing_time < 0.01  # 10msä»¥å†…
```

## å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### Phase 1: å®Œå…¨çµ±åˆãƒãƒƒãƒ”ãƒ³ã‚°æ©Ÿèƒ½ï¼ˆ2é€±é–“ï¼‰
1. CompleteCitationManagerã‚¯ãƒ©ã‚¹å®Ÿè£…
2. YAMLãƒ˜ãƒƒãƒ€ãƒ¼å®Œå…¨çµ±åˆæ©Ÿèƒ½
3. references.bibèª­ã¿è¾¼ã¿ãƒ»å¤‰æ›æ©Ÿèƒ½
4. åŸºæœ¬ãƒ†ã‚¹ãƒˆä½œæˆãƒ»å®Ÿè¡Œ

### Phase 2: è‡ªå·±å®Œçµå‹AIçµ±åˆãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆæ©Ÿèƒ½ï¼ˆ2é€±é–“ï¼‰
1. SelfContainedAIGeneratorã‚¯ãƒ©ã‚¹å®Ÿè£…
2. YAMLãƒ˜ãƒƒãƒ€ãƒ¼ã®ã¿ã‹ã‚‰ã®Citation Reference Tableç”Ÿæˆ
3. é«˜é€Ÿå‡¦ç†æœ€é©åŒ–
4. è‡ªå·±å®Œçµæ€§æ¤œè¨¼æ©Ÿèƒ½

### Phase 3: çµ±åˆãƒ»æœ€é©åŒ–ï¼ˆ1é€±é–“ï¼‰
1. æ—¢å­˜ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¸ã®çµ±åˆ
2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
3. åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

### Phase 4: ãƒªãƒªãƒ¼ã‚¹æº–å‚™ï¼ˆ1é€±é–“ï¼‰
1. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
2. è¨­å®šã‚·ã‚¹ãƒ†ãƒ æ•´å‚™
3. æœ€çµ‚æ¤œè¨¼

## æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

### è‡ªå·±å®Œçµæ€§ã«ã‚ˆã‚‹åˆ©ç‚¹
- **å¤–éƒ¨ä¾å­˜æ’é™¤**: references.bibãŒãªãã¦ã‚‚å®Œå…¨å‹•ä½œ
- **é«˜é€Ÿå‡¦ç†**: ãƒ•ã‚¡ã‚¤ãƒ«I/Oå‰Šæ¸›ã«ã‚ˆã‚Šå¤§å¹…ãªå‡¦ç†æ™‚é–“çŸ­ç¸®
- **ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§**: å…¨æƒ…å ±ãŒYAMLãƒ˜ãƒƒãƒ€ãƒ¼ã«çµ±åˆã•ã‚Œã€æ•´åˆæ€§ä¿è¨¼
- **ãƒãƒ¼ã‚¿ãƒ“ãƒªãƒ†ã‚£**: ãƒ•ã‚¡ã‚¤ãƒ«å˜ä½“ã§å®Œçµã€ç§»å‹•ãƒ»å…±æœ‰ãŒå®¹æ˜“

### AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆåˆ©ç”¨ã®é©å‘½çš„æ”¹å–„
- **å®Œå…¨ãªå¼•ç”¨ç†è§£**: AIãŒ[1],[2],[3]ã®æ„å‘³ã‚’å®Œå…¨æŠŠæ¡
- **é©åˆ‡ãªè«–æ–‡ç”Ÿæˆ**: å¼•ç”¨æƒ…å ±ã‚’ç†è§£ã—ãŸé«˜å“è³ªãªè«–æ–‡ä½œæˆ
- **ä½œæ¥­åŠ¹ç‡å‘ä¸Š**: æº–å‚™ä¸è¦ã§AIã«è«–æ–‡åŸ·ç­†ä¾é ¼ãŒå¯èƒ½

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ”¹å–„
- **ã‚·ãƒ³ãƒ—ãƒ«ãªã‚³ãƒãƒ³ãƒ‰**: 1ã¤ã®ã‚³ãƒãƒ³ãƒ‰ã§AIç”¨ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
- **çµ±åˆå®Ÿè¡Œ**: run-integratedã«è‡ªå‹•çµ„ã¿è¾¼ã¿
- **ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸è¦**: å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«åŒæœŸã®å•é¡Œè§£æ¶ˆ

## ä½¿ç”¨ä¾‹

### åŸºæœ¬çš„ãªä½¿ç”¨ãƒ•ãƒ­ãƒ¼

```bash
# 1. åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼šreferences.bibã‹ã‚‰å®Œå…¨ãªå¼•ç”¨æƒ…å ±ã‚’YAMLãƒ˜ãƒƒãƒ€ãƒ¼ã«çµ±åˆ
PYTHONPATH=code/py uv run python code/py/main.py create-complete-mapping \
    --input "pancreatic_cancer_analysis.md" \
    --references "references.bib"

# 2. ä»¥é™ã¯å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ä¸è¦ï¼šAIç”¨ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
PYTHONPATH=code/py uv run python code/py/main.py generate-ai-format \
    --input "pancreatic_cancer_analysis.md" \
    --output "pancreatic_cancer_for_ai.md"

# 3. ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã«æä¾›
# â†’ AIãŒå¼•ç”¨æ–‡çŒ®ã‚’å®Œå…¨ç†è§£
# â†’ é«˜å“è³ªãªè«–æ–‡åŸ·ç­†ãƒ»è¦ç´„ãƒ»åˆ†æãŒå¯èƒ½
```

### å‡ºåŠ›ä¾‹æ¯”è¼ƒ

#### Beforeï¼ˆå¾“æ¥ï¼‰
```
# AIã«æä¾›ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«
Recent studies suggest that KRTs are mediators [1],[2],[3].

# AIã®åå¿œ
AI: ã€Œ[1],[2],[3]ãŒä½•ã®æ–‡çŒ®ã‹åˆ†ã‹ã‚‰ãªã„ãŸã‚ã€é©åˆ‡ãªå¼•ç”¨ä»˜ãæ–‡ç« ã‚’ä½œæˆã§ãã¾ã›ã‚“ã€
```

#### Afterï¼ˆv4.0è‡ªå·±å®Œçµå‹ï¼‰
```
# AIã«æä¾›ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆè‡ªå‹•ç”Ÿæˆã€å¤–éƒ¨ä¾å­˜ãªã—ï¼‰
## ğŸ“š Citation Reference Table
[1] â†’ Smith, J. et al. (2023). "Novel Method for Cancer Analysis". Cancer Research, 83(12), 1234-1245.
    â””â”€ **Abstract**: This paper introduces innovative methodologies for analyzing cancer cell behavior...

[2] â†’ Jones, M. & Wilson, K. (2022). "Advanced Biomarker Techniques". Nature Medicine, 28, 567-578.
    â””â”€ **Abstract**: Comprehensive review of current biomarker applications in cancer diagnosis...

## ğŸ“„ Paper Content
Recent studies suggest that KRTs are mediators [1],[2],[3].

# AIã®åå¿œ
AI: ã€ŒSmith et al.ã®ç™Œç´°èƒè§£ææ‰‹æ³•[1]ã€Jonesã®ãƒã‚¤ã‚ªãƒãƒ¼ã‚«ãƒ¼æŠ€è¡“[2]ã€Brownã®è¨ºæ–­æ‰‹æ³•[3]ã‚’è¸ã¾ãˆã¦ã€
     é©åˆ‡ãªå¼•ç”¨ä»˜ãã®è«–æ–‡ã‚’åŸ·ç­†ã„ãŸã—ã¾ã™ã€
```

---

**v4.0ã®é©æ–°ãƒã‚¤ãƒ³ãƒˆï¼šå®Œå…¨è‡ªå·±å®Œçµå‹ã§AIãŒå¼•ç”¨æ–‡çŒ®ã‚’ç¬æ™‚ã«ç†è§£ã€å¤–éƒ¨ä¾å­˜ã‚¼ãƒ­ã®é«˜é€Ÿå‡¦ç†ã‚’å®Ÿç¾**